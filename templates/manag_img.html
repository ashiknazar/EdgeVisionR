<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>EdgeVision</title>
    <!-- Favicon-->
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='assets/favicon.ico') }}" />
    <!-- Bootstrap icons-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet" />
    <!-- Core theme CSS (includes Bootstrap)-->
    <link href="{{ url_for('static', filename='css/styles.css') }}" rel="stylesheet" />
    <script>
        function startStream() {
            fetch("/start_stream", { method: "POST" })
                .then(() => {
                    document.getElementById("video").src = "/video_feed";
                });
        }

        function stopStream() {
            fetch("/stop_stream", { method: "POST" })
                .then(() => {
                    document.getElementById("video").src = "";
                });
        }
        function captureImage() {
    fetch("/stop_stream", { method: "POST" })  // Ensure streaming stops
        .then(response => response.text())
        .then(() => {
            setTimeout(() => {
                document.getElementById("captureForm").submit();
            }, 1000); // Ensure enough time for camera to release
        })
        .catch(error => console.error("Error stopping stream:", error));
        }

        function deleteImage(imageName) {
            if (confirm("Are you sure you want to delete this image?")) {
                fetch(`/delete_image/${imageName}`, { method: "POST" })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            location.reload();  // Refresh page after deletion
                        } else {
                            alert("Error deleting image.");
                        }
                    });
            }
        }

    </script>
</head>
<body>
    <!-- Responsive navbar-->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container px-lg-5">
            <a class="navbar-brand" href="#">EdgeVision</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-con>            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                    <li class="nav-item"><a class="nav-link active" href="#">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="#">About</a></li>
                    <li class="nav-item"><a class="nav-link" href="#">Contact</a></li>
                </ul>
            </div>
        </div>
    </nav>
   <!-- Header -->
   <header class="py-5">
    <div class="container px-lg-5">
        <div class="row">
            <!-- Left Section: Video Streaming Box -->
            <div class="col-lg-6 col-12 d-flex align-items-center">
                <div class="p-4 p-lg-5 bg-light rounded-3 w-100 d-flex align-items-center justify-content-center">
                    <img id="video" src="" class="w-100 rounded" style="height: 350px; object-fit: cover; background: #000;" alt="Li>                </div>
            </div>
            
            <!-- Right Section: Buttons and Input -->
            <div class="col-lg-6 col-12 d-flex flex-column justify-content-center align-items-center">
                <div class="d-flex gap-3 mb-3 w-100">
                    <!-- Start Stream Button -->
                    <a href="#" onclick="startStream()" class="btn btn-success btn-lg flex-grow-1 d-flex align-items-center justify->                        <i class="bi bi-play-circle"></i> Start Stream
                    </a>

                    <!-- Stop Stream Button -->
                    <a href="#" onclick="stopStream()" class="btn btn-danger btn-lg flex-grow-1 d-flex align-items-center justify-co>                        <i class="bi bi-stop-circle"></i> Stop Stream
                    </a>
                </div>

                <!-- Input field and Capture Image button -->
                <form id="captureForm" method="POST" action="{{ url_for('capture') }}" class="w-100">
                    <div class="d-flex gap-3 w-100">
                        <!-- Input field (Same height as buttons) -->
                        <input type="text" name="image_name" required class="form-control flex-grow-1 text-center" placeholder="Who >
                        <!-- Capture Image Button -->
                        <button type="submit" onclick="captureImage()" class="btn btn-primary btn-lg flex-grow-1 d-flex align-items->                            <i class="bi bi-camera"></i> Capture
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</header>
    <!-- Saved Images Section -->
<section class="py-5 bg-light">
    <div class="container px-lg-5">
        <h2 class="text-center mb-4">Saved Images</h2>
        <div class="row">
            {% for image in images %}
            <div class="col-md-3 col-sm-6 mb-4 d-flex flex-column align-items-center">
                <div class="card shadow-sm border-0 rounded text-center" style="width: 100%;">
                    <img src="{{ url_for('static', filename=image) }}" class="card-img-top" style="height: 150px; object-fit: cover;>                    <div class="card-body">
                        <p class="card-text text-truncate" title="{{ image }}">{{ image }}</p>
                        <button onclick="deleteImage('{{ image }}')" class="btn btn-danger btn-sm">
                            <i class="bi bi-trash"></i> Delete
                        </button>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>




    <!-- Footer -->
    <footer class="py-5 bg-dark">
        <div class="container"><p class="m-0 text-center text-white">Copyright &copy; Your Website 2023</p></div>
    </footer>

    <!-- Bootstrap core JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Core theme JS -->
    <script src="{{ url_for('static', filename='js/scripts.js') }}"></script>
</body>
</html>